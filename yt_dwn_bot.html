<html>

<head>
    <meta charset="UTF-8">
    <title>Settings</title>

    <!--Подключаем скрипт от телеграм-->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>

    <!--Группа радио-кнопок с выбором типа загрузки-->
    <fieldset>
        <legend>Download type</legend>

        <div>
            <input type="radio" id="radio_ask" name="radio_group" value="ask" checked />
            <label for="radio_ask">Ask me</label>
        </div>

        <div>
            <input type="radio" id="radio_video" name="radio_group" value="video" />
            <label for="radio_video">Video</label>
        </div>

        <div>
            <input type="radio" id="radio_audio" name="radio_group" value="audio" />
            <label for="radio_audio">Audio</label>
        </div>

        <div>
            <input type="radio" id="radio_comments" name="radio_group" value="comments" />
            <label for="radio_comments">Comments</label>
        </div>
    </fieldset>

    <!--Отметка о скачивании как документа-->
    <div>
        <input type="checkbox" id="check_document" name="check_document" />
        <label for="check_document">Send as document</label>
    </div>

    <!--Кнопка "Сохранить"-->
    <!--<button id="button_save" class="button">Save</button>-->
</body>

</html>

<script type="text/javascript">

    let tg = window.Telegram.WebApp; //получаем объект webapp телеграма

    tg.expand(); //расширяем на все окно

    tg.MainButton.text = "Save";
    tg.MainButton.show();

    // Обработчик кнопки сохранения
    //document.getElementById("button_save").addEventListener('click', function () {
    //    // Получаем тип загрузки
    //    let download_type = document.querySelector('input[name="radio_group"]:checked').value;
    //    console.log(download_type);

    //    // Флаг отправки файла как документа
    //    let as_document = document.getElementById('check_document').checked;

    //    if (as_document) {
    //        //alert("checked");
    //    }
    //});

    Telegram.WebApp.onEvent('mainButtonClicked', function () {

        //let json_object =
        //{
        //    "download_type": document.querySelector('input[name="radio_group"]:checked').value,
        //    "as_document": document.getElementById('check_document').checked
        //};

        const json_object = JSON.stringify(
        {
            download_type: document.querySelector('input[name="radio_group"]:checked').value,
            as_document: document.getElementById('check_document').checked
        });

        Telegram.WebApp.sendData(json_object);
        Telegram.WebApp.close();

        //tg.sendData("some string that we need to send");
        //tg.sendData(json_object);
    });

</script>
